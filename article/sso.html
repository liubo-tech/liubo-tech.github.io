<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>背景 | 牛初九博客</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="Java 技术 互联网 Spring Redis Mysql ">
    <meta name="keywords" content="Java 技术 互联网 Spring SpringBoot SpringCloud Elastic Search MySQL MyCAT 分布式 集群">
    
    <link rel="preload" href="/assets/css/0.styles.fab77d47.css" as="style"><link rel="preload" href="/assets/js/app.16ffb530.js" as="script"><link rel="preload" href="/assets/js/2.2805d820.js" as="script"><link rel="preload" href="/assets/js/11.bf2b4ef3.js" as="script"><link rel="prefetch" href="/assets/js/10.7af0fa3b.js"><link rel="prefetch" href="/assets/js/12.ffa316c1.js"><link rel="prefetch" href="/assets/js/13.7bf9e28b.js"><link rel="prefetch" href="/assets/js/14.fe8172bf.js"><link rel="prefetch" href="/assets/js/15.12492866.js"><link rel="prefetch" href="/assets/js/16.1e0b9828.js"><link rel="prefetch" href="/assets/js/17.5274e857.js"><link rel="prefetch" href="/assets/js/18.14c495e2.js"><link rel="prefetch" href="/assets/js/19.0065f7d5.js"><link rel="prefetch" href="/assets/js/20.15195b8f.js"><link rel="prefetch" href="/assets/js/21.a49d2486.js"><link rel="prefetch" href="/assets/js/22.7625f3ea.js"><link rel="prefetch" href="/assets/js/23.6829be75.js"><link rel="prefetch" href="/assets/js/24.d89bf6ba.js"><link rel="prefetch" href="/assets/js/25.f9c8e982.js"><link rel="prefetch" href="/assets/js/26.df00cb25.js"><link rel="prefetch" href="/assets/js/27.c2c39573.js"><link rel="prefetch" href="/assets/js/28.9d6955a7.js"><link rel="prefetch" href="/assets/js/29.793a5925.js"><link rel="prefetch" href="/assets/js/3.99170183.js"><link rel="prefetch" href="/assets/js/30.1d4eb018.js"><link rel="prefetch" href="/assets/js/31.c3635b83.js"><link rel="prefetch" href="/assets/js/32.39f76767.js"><link rel="prefetch" href="/assets/js/33.9623bd00.js"><link rel="prefetch" href="/assets/js/34.685b37ce.js"><link rel="prefetch" href="/assets/js/35.b6d262de.js"><link rel="prefetch" href="/assets/js/36.706cce0c.js"><link rel="prefetch" href="/assets/js/37.4b559cf9.js"><link rel="prefetch" href="/assets/js/38.8440f0a1.js"><link rel="prefetch" href="/assets/js/39.89829fe9.js"><link rel="prefetch" href="/assets/js/4.44e35b71.js"><link rel="prefetch" href="/assets/js/40.1eae592a.js"><link rel="prefetch" href="/assets/js/41.307e59e5.js"><link rel="prefetch" href="/assets/js/42.9c9598a9.js"><link rel="prefetch" href="/assets/js/43.6de9381c.js"><link rel="prefetch" href="/assets/js/44.0bda172b.js"><link rel="prefetch" href="/assets/js/45.7bd4678e.js"><link rel="prefetch" href="/assets/js/46.9601296c.js"><link rel="prefetch" href="/assets/js/47.8279d007.js"><link rel="prefetch" href="/assets/js/48.e8ae43c5.js"><link rel="prefetch" href="/assets/js/49.088eb890.js"><link rel="prefetch" href="/assets/js/5.7b7d1525.js"><link rel="prefetch" href="/assets/js/50.a104d084.js"><link rel="prefetch" href="/assets/js/51.0c101ee6.js"><link rel="prefetch" href="/assets/js/52.4269f250.js"><link rel="prefetch" href="/assets/js/53.1c55a938.js"><link rel="prefetch" href="/assets/js/54.dab6fc62.js"><link rel="prefetch" href="/assets/js/55.18a1bf4c.js"><link rel="prefetch" href="/assets/js/56.b2c0ee59.js"><link rel="prefetch" href="/assets/js/57.0a78afcc.js"><link rel="prefetch" href="/assets/js/58.d75522d5.js"><link rel="prefetch" href="/assets/js/59.2543ea7e.js"><link rel="prefetch" href="/assets/js/6.6d27b31c.js"><link rel="prefetch" href="/assets/js/60.16f65788.js"><link rel="prefetch" href="/assets/js/61.d6e2d8b6.js"><link rel="prefetch" href="/assets/js/62.183c4095.js"><link rel="prefetch" href="/assets/js/63.920617f0.js"><link rel="prefetch" href="/assets/js/64.5b2731e6.js"><link rel="prefetch" href="/assets/js/65.56420cc0.js"><link rel="prefetch" href="/assets/js/66.2ebd0c92.js"><link rel="prefetch" href="/assets/js/67.a414b285.js"><link rel="prefetch" href="/assets/js/68.989dacce.js"><link rel="prefetch" href="/assets/js/69.79a844b9.js"><link rel="prefetch" href="/assets/js/7.fee5c0b2.js"><link rel="prefetch" href="/assets/js/70.b789f7cb.js"><link rel="prefetch" href="/assets/js/71.90a71409.js"><link rel="prefetch" href="/assets/js/72.0dee4533.js"><link rel="prefetch" href="/assets/js/73.72b757a5.js"><link rel="prefetch" href="/assets/js/74.5cc6a8e7.js"><link rel="prefetch" href="/assets/js/75.a3efa729.js"><link rel="prefetch" href="/assets/js/76.ee52fbb0.js"><link rel="prefetch" href="/assets/js/77.2c257317.js"><link rel="prefetch" href="/assets/js/78.831d9b7b.js"><link rel="prefetch" href="/assets/js/79.7940520a.js"><link rel="prefetch" href="/assets/js/8.7f9f9c54.js"><link rel="prefetch" href="/assets/js/80.2f951622.js"><link rel="prefetch" href="/assets/js/81.fb674315.js"><link rel="prefetch" href="/assets/js/82.b9069b51.js"><link rel="prefetch" href="/assets/js/83.d718aedc.js"><link rel="prefetch" href="/assets/js/84.95180f04.js"><link rel="prefetch" href="/assets/js/85.3253eaff.js"><link rel="prefetch" href="/assets/js/86.3663d770.js"><link rel="prefetch" href="/assets/js/87.0c11349f.js"><link rel="prefetch" href="/assets/js/88.f5fac9dc.js"><link rel="prefetch" href="/assets/js/89.5e9c86e8.js"><link rel="prefetch" href="/assets/js/9.759c07c6.js"><link rel="prefetch" href="/assets/js/90.faeb161a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fab77d47.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">牛初九博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/gzh/gzh.html" class="nav-link">
  公众号
</a></div><div class="nav-item"><a href="/es/es.html" class="nav-link">
  ES系列
</a></div><div class="nav-item"><a href="/rocket/rocket.html" class="nav-link">
  RocketMQ系列
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="慕课课程" class="dropdown-title"><span class="title">慕课课程</span> <span class="arrow down"></span></button> <button type="button" aria-label="慕课课程" class="mobile-dropdown-title"><span class="title">慕课课程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://coding.imooc.com/class/341.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  精讲分布式定时任务
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://class.imooc.com/sale/javaarchitect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java架构师直通车
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/gzh/gzh.html" class="nav-link">
  公众号
</a></div><div class="nav-item"><a href="/es/es.html" class="nav-link">
  ES系列
</a></div><div class="nav-item"><a href="/rocket/rocket.html" class="nav-link">
  RocketMQ系列
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="慕课课程" class="dropdown-title"><span class="title">慕课课程</span> <span class="arrow down"></span></button> <button type="button" aria-label="慕课课程" class="mobile-dropdown-title"><span class="title">慕课课程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://coding.imooc.com/class/341.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  精讲分布式定时任务
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://class.imooc.com/sale/javaarchitect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java架构师直通车
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/article/nacos.html" class="sidebar-link">注册中心Nacos集群搭建</a></li><li><a href="/article/nacos-1.html" class="sidebar-link">Nacos配置中心和服务的注册发现</a></li><li><a href="/article/login.html" class="sidebar-link">怎样实现登录？| Cookie or JWT</a></li><li><a href="/article/oauth.html" class="sidebar-link">OAuth授权</a></li><li><a href="/article/sso.html" aria-current="page" class="active sidebar-link">SSO单点登录流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/sso.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/article/sso.html#技术实现" class="sidebar-link">技术实现</a></li><li class="sidebar-sub-header"><a href="/article/sso.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/article/front-back.html" class="sidebar-link">前后端分离 | 登录状态</a></li><li><a href="/article/MySQL+Keepalived.html" class="sidebar-link">MySQL+Keepalived高可用</a></li><li><a href="/article/mysql-ms.html" class="sidebar-link">MySQL主从同步配置</a></li><li><a href="/article/mysql-huan.html" class="sidebar-link">MySQL中的幻读，你真的理解吗？</a></li><li><a href="/article/db-pool.html" class="sidebar-link">数据库连接池数量设置为多少？</a></li><li><a href="/article/CSRF.html" class="sidebar-link">CSRF的原理与防御</a></li><li><a href="/article/redis-lock.html" class="sidebar-link">Redis分布式锁</a></li><li><a href="/article/limit.html" class="sidebar-link">MySql分页查询慢</a></li><li><a href="/article/taglib.html" class="sidebar-link">自制权限框架（一）jsp标签</a></li><li><a href="/article/annotation.html" class="sidebar-link">自制权限框架（二）注解</a></li><li><a href="/article/jmeter-1.html" class="sidebar-link">JMeter测试（一）</a></li><li><a href="/article/jmeter-2.html" class="sidebar-link">JMeter测试（二）</a></li><li><a href="/article/spring-security.html" class="sidebar-link">Spring Security实现RBAC权限管理</a></li><li><a href="/article/nginx1.html" class="sidebar-link">Nginx简介（一）</a></li><li><a href="/article/nginx2.html" class="sidebar-link">Nginx简介（二）</a></li><li><a href="/article/string.html" class="sidebar-link">String是值传递还是引用传递</a></li><li><a href="/article/redis-cluster.html" class="sidebar-link">Redis集群</a></li><li><a href="/article/cas.html" class="sidebar-link">CAS与OAuth2的区别</a></li><li><a href="/article/spring-eureka-2.html" class="sidebar-link">Eureka服务注册与发现</a></li><li><a href="/article/spring-mobile.html" class="sidebar-link">Spring Mobile</a></li><li><a href="/article/es-1.html" class="sidebar-link">ES学习（一）ES的安装与启动</a></li><li><a href="/article/es-2.html" class="sidebar-link">ES学习（二）ES的集群原理</a></li><li><a href="/article/es-3.html" class="sidebar-link">ES学习（三）新建索引</a></li><li><a href="/article/es-4.html" class="sidebar-link">ES学习（四）字段类型（mapping）</a></li><li><a href="/article/es-5.html" class="sidebar-link">ES学习（五）动态映射</a></li><li><a href="/article/es-6.html" class="sidebar-link">ES学习（六）分析器</a></li><li><a href="/article/es-7.html" class="sidebar-link">ES学习（七）IK中文分词器</a></li><li><a href="/article/es-8.html" class="sidebar-link">ES学习（八）数据的增删改</a></li><li><a href="/article/es-9.html" class="sidebar-link">ES学习（九）搜索</a></li><li><a href="/article/es-10.html" class="sidebar-link">ES学习（十）聚合查询</a></li><li><a href="/article/es-11.html" class="sidebar-link">ES学习（十一）与SpringBoot结合</a></li><li><a href="/article/es-12.html" class="sidebar-link">ES学习（十二）高亮 和 搜索建议</a></li><li><a href="/article/es-13.html" class="sidebar-link">ES学习（十三）GEO位置搜索</a></li><li><a href="/article/rocketmq-1.html" class="sidebar-link">RocketMQ系列（一）基本概念</a></li><li><a href="/article/rocketmq-2.html" class="sidebar-link">RocketMQ系列（二）环境搭建</a></li><li><a href="/article/rocketmq-3.html" class="sidebar-link">RocketMQ系列（三）消息的生产与消费</a></li><li><a href="/article/rocketmq-4.html" class="sidebar-link">RocketMQ系列（四）顺序消费</a></li><li><a href="/article/rocketmq-5.html" class="sidebar-link">RocketMQ系列（五）广播与延迟消息</a></li><li><a href="/article/rocketmq-6.html" class="sidebar-link">RocketMQ系列（六）批量发送与过滤</a></li><li><a href="/article/rocketmq-7.html" class="sidebar-link">RocketMQ系列（七）事务消息</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>在企业发展初期，企业使用的系统很少，通常一个或者两个，每个系统都有自己的登录模块，运营人员每天用自己的账号登录，很方便。
但随着企业的发展，用到的系统随之增多，运营人员在操作不同的系统时，需要多次登录，而且每个系统的账号都不一样，这对于运营人员
来说，很不方便。于是，就想到是不是可以在一个系统登录，其他系统就不用登录了呢？这就是单点登录要解决的问题。</p> <p>单点登录英文全称Single Sign On，简称就是SSO。它的解释是：<strong>在多个应用系统中，只需要登录一次，就可以访问其他相互信任的应用系统。</strong></p> <p><img src="/assets/img/sso-1.0ab213d0.png" alt="image"></p> <p>如图所示，图中有4个系统，分别是Application1、Application2、Application3、和SSO。Application1、Application2、Application3没有登录模块，而SSO只有登录模块，没有其他的业务模块，当Application1、Application2、Application3需要登录时，将跳到SSO系统，SSO系统完成登录，其他的应用系统也就随之登录了。这完全符合我们对单点登录（SSO）的定义。</p> <h2 id="技术实现"><a href="#技术实现" class="header-anchor">#</a> 技术实现</h2> <p>在说单点登录（SSO）的技术实现之前，我们先说一说普通的登录认证机制。
<img src="data:image/png;base64,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" alt="image"></p> <p>如上图所示，我们在浏览器（Browser）中访问一个应用，这个应用需要登录，我们填写完用户名和密码后，完成登录认证。这时，我们在这个用户的session中标记登录状态为yes（已登录），同时在浏览器（Browser）中写入Cookie，这个Cookie是这个用户的唯一标识。下次我们再访问这个应用的时候，请求中会带上这个Cookie，服务端会根据这个Cookie找到对应的session，通过session来判断这个用户是否登录。如果不做特殊配置，这个Cookie的名字叫做jsessionid，值在服务端（server）是唯一的。</p> <h3 id="同域下的单点登录"><a href="#同域下的单点登录" class="header-anchor">#</a> 同域下的单点登录</h3> <p>一个企业一般情况下只有一个域名，通过二级域名区分不同的系统。比如我们有个域名叫做：a.com，同时有两个业务系统分别为：app1.a.com和app2.a.com。我们要做单点登录（SSO），需要一个登录系统，叫做：sso.a.com。</p> <p>我们只要在sso.a.com登录，app1.a.com和app2.a.com就也登录了。通过上面的登陆认证机制，我们可以知道，在sso.a.com中登录了，其实是在sso.a.com的服务端的session中记录了登录状态，同时在浏览器端（Browser）的sso.a.com下写入了Cookie。那么我们怎么才能让app1.a.com和app2.a.com登录呢？这里有两个问题：</p> <ul><li>Cookie是不能跨域的，我们Cookie的domain属性是sso.a.com，在给app1.a.com和app2.a.com发送请求是带不上的。</li> <li>sso、app1和app2是不同的应用，它们的session存在自己的应用内，是不共享的。</li></ul> <p><img src="/assets/img/sso-3.02d8a87b.png" alt="image"></p> <p>那么我们如何解决这两个问题呢？针对第一个问题，sso登录以后，可以将Cookie的域设置为顶域，即.a.com，这样所有子域的系统都可以访问到顶域的Cookie。<strong>我们在设置Cookie时，只能设置顶域和自己的域，不能设置其他的域。比如：我们不能在自己的系统中给baidu.com的域设置Cookie。</strong></p> <p>Cookie的问题解决了，我们再来看看session的问题。我们在sso系统登录了，这时再访问app1，Cookie也带到了app1的服务端（Server），app1的服务端怎么找到这个Cookie对应的Session呢？这里就要把3个系统的Session共享，如图所示。共享Session的解决方案有很多，例如：Spring-Session。这样第2个问题也解决了。</p> <p>同域下的单点登录就实现了，<strong>但这还不是真正的单点登录。</strong></p> <h3 id="不同域下的单点登录"><a href="#不同域下的单点登录" class="header-anchor">#</a> 不同域下的单点登录</h3> <p>同域下的单点登录是巧用了Cookie顶域的特性。如果是不同域呢？不同域之间Cookie是不共享的，怎么办？</p> <p>这里我们就要说一说CAS流程了，这个流程是单点登录的标准流程。
<img src="/assets/img/sso-4.fdbacd05.png" alt="cas_flow_diagram"></p> <p>上图是CAS官网上的标准流程，具体流程如下：</p> <ol><li>用户访问app系统，app系统是需要登录的，但用户现在没有登录。</li> <li>跳转到CAS server，即SSO登录系统，<strong>以后图中的CAS Server我们统一叫做SSO系统。</strong> SSO系统也没有登录，弹出用户登录页。</li> <li>用户填写用户名、密码，SSO系统进行认证后，将登录状态写入SSO的session，浏览器（Browser）中写入SSO域下的Cookie。</li> <li>SSO系统登录完成后会生成一个ST（Service Ticket），然后跳转到app系统，同时将ST作为参数传递给app系统。</li> <li>app系统拿到ST后，从后台向SSO发送请求，验证ST是否有效。</li> <li>验证通过后，app系统将登录状态写入session并设置app域下的Cookie。</li></ol> <p>至此，跨域单点登录就完成了。以后我们再访问app系统时，app就是登录的。接下来，我们再看看访问app2系统时的流程。</p> <ol><li>用户访问app2系统，app2系统没有登录，跳转到SSO。</li> <li>由于SSO已经登录了，不需要重新登录认证。</li> <li>SSO生成ST，浏览器跳转到app2系统，并将ST作为参数传递给app2。</li> <li>app2拿到ST，后台访问SSO，验证ST是否有效。</li> <li>验证成功后，app2将登录状态写入session，并在app2域下写入Cookie。</li></ol> <p>这样，app2系统不需要走登录流程，就已经是登录了。SSO，app和app2在不同的域，它们之间的session不共享也是没问题的。</p> <p><strong>有的同学问我，SSO系统登录后，跳回原业务系统时，带了个参数ST，业务系统还要拿ST再次访问SSO进行验证，觉得这个步骤有点多余。他想SSO登录认证通过后，通过回调地址将用户信息返回给原业务系统，原业务系统直接设置登录状态，这样流程简单，也完成了登录，不是很好吗？</strong></p> <p><strong>其实这样问题时很严重的，如果我在SSO没有登录，而是直接在浏览器中敲入回调的地址，并带上伪造的用户信息，是不是业务系统也认为登录了呢？这是很可怕的。</strong></p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>单点登录（SSO）的所有流程都介绍完了，原理大家都清楚了。总结一下单点登录要做的事情：</p> <ul><li><strong>单点登录（SSO系统）是保障各业务系统的用户资源的安全 。</strong></li> <li><strong>各个业务系统获得的信息是，这个用户能不能访问我的资源。</strong></li> <li><strong>单点登录，资源都在各个业务系统这边，不在SSO那一方。 用户在给SSO服务器提供了用户名密码后，作为业务系统并不知道这件事。 SSO随便给业务系统一个ST，那么业务系统是不能确定这个ST是用户伪造的，还是真的有效，所以要拿着这个ST去SSO服务器再问一下，这个用户给我的ST是否有效，是有效的我才能让这个用户访问。</strong></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/article/oauth.html" class="prev">
        OAuth授权
      </a></span> <span class="next"><a href="/article/front-back.html">
        前后端分离 | 登录状态
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.16ffb530.js" defer></script><script src="/assets/js/2.2805d820.js" defer></script><script src="/assets/js/11.bf2b4ef3.js" defer></script>
  </body>
</html>
