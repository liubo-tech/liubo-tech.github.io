<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MongoDB之副本集   返回 | 牛初九博客</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="Java 技术 互联网 Spring Redis Mysql ">
    <meta name="keywords" content="Java 技术 互联网 Spring SpringBoot SpringCloud Elastic Search MySQL MyCAT 分布式 集群">
    
    <link rel="preload" href="/assets/css/0.styles.fab77d47.css" as="style"><link rel="preload" href="/assets/js/app.16ffb530.js" as="script"><link rel="preload" href="/assets/js/2.2805d820.js" as="script"><link rel="preload" href="/assets/js/57.0a78afcc.js" as="script"><link rel="prefetch" href="/assets/js/10.7af0fa3b.js"><link rel="prefetch" href="/assets/js/11.bf2b4ef3.js"><link rel="prefetch" href="/assets/js/12.ffa316c1.js"><link rel="prefetch" href="/assets/js/13.7bf9e28b.js"><link rel="prefetch" href="/assets/js/14.fe8172bf.js"><link rel="prefetch" href="/assets/js/15.12492866.js"><link rel="prefetch" href="/assets/js/16.1e0b9828.js"><link rel="prefetch" href="/assets/js/17.5274e857.js"><link rel="prefetch" href="/assets/js/18.14c495e2.js"><link rel="prefetch" href="/assets/js/19.0065f7d5.js"><link rel="prefetch" href="/assets/js/20.15195b8f.js"><link rel="prefetch" href="/assets/js/21.a49d2486.js"><link rel="prefetch" href="/assets/js/22.7625f3ea.js"><link rel="prefetch" href="/assets/js/23.6829be75.js"><link rel="prefetch" href="/assets/js/24.d89bf6ba.js"><link rel="prefetch" href="/assets/js/25.f9c8e982.js"><link rel="prefetch" href="/assets/js/26.df00cb25.js"><link rel="prefetch" href="/assets/js/27.c2c39573.js"><link rel="prefetch" href="/assets/js/28.9d6955a7.js"><link rel="prefetch" href="/assets/js/29.793a5925.js"><link rel="prefetch" href="/assets/js/3.99170183.js"><link rel="prefetch" href="/assets/js/30.1d4eb018.js"><link rel="prefetch" href="/assets/js/31.c3635b83.js"><link rel="prefetch" href="/assets/js/32.39f76767.js"><link rel="prefetch" href="/assets/js/33.9623bd00.js"><link rel="prefetch" href="/assets/js/34.685b37ce.js"><link rel="prefetch" href="/assets/js/35.b6d262de.js"><link rel="prefetch" href="/assets/js/36.706cce0c.js"><link rel="prefetch" href="/assets/js/37.4b559cf9.js"><link rel="prefetch" href="/assets/js/38.8440f0a1.js"><link rel="prefetch" href="/assets/js/39.89829fe9.js"><link rel="prefetch" href="/assets/js/4.44e35b71.js"><link rel="prefetch" href="/assets/js/40.1eae592a.js"><link rel="prefetch" href="/assets/js/41.307e59e5.js"><link rel="prefetch" href="/assets/js/42.9c9598a9.js"><link rel="prefetch" href="/assets/js/43.6de9381c.js"><link rel="prefetch" href="/assets/js/44.0bda172b.js"><link rel="prefetch" href="/assets/js/45.7bd4678e.js"><link rel="prefetch" href="/assets/js/46.9601296c.js"><link rel="prefetch" href="/assets/js/47.8279d007.js"><link rel="prefetch" href="/assets/js/48.e8ae43c5.js"><link rel="prefetch" href="/assets/js/49.088eb890.js"><link rel="prefetch" href="/assets/js/5.7b7d1525.js"><link rel="prefetch" href="/assets/js/50.a104d084.js"><link rel="prefetch" href="/assets/js/51.0c101ee6.js"><link rel="prefetch" href="/assets/js/52.4269f250.js"><link rel="prefetch" href="/assets/js/53.1c55a938.js"><link rel="prefetch" href="/assets/js/54.dab6fc62.js"><link rel="prefetch" href="/assets/js/55.18a1bf4c.js"><link rel="prefetch" href="/assets/js/56.b2c0ee59.js"><link rel="prefetch" href="/assets/js/58.d75522d5.js"><link rel="prefetch" href="/assets/js/59.2543ea7e.js"><link rel="prefetch" href="/assets/js/6.6d27b31c.js"><link rel="prefetch" href="/assets/js/60.16f65788.js"><link rel="prefetch" href="/assets/js/61.d6e2d8b6.js"><link rel="prefetch" href="/assets/js/62.183c4095.js"><link rel="prefetch" href="/assets/js/63.920617f0.js"><link rel="prefetch" href="/assets/js/64.5b2731e6.js"><link rel="prefetch" href="/assets/js/65.56420cc0.js"><link rel="prefetch" href="/assets/js/66.2ebd0c92.js"><link rel="prefetch" href="/assets/js/67.a414b285.js"><link rel="prefetch" href="/assets/js/68.989dacce.js"><link rel="prefetch" href="/assets/js/69.79a844b9.js"><link rel="prefetch" href="/assets/js/7.fee5c0b2.js"><link rel="prefetch" href="/assets/js/70.b789f7cb.js"><link rel="prefetch" href="/assets/js/71.90a71409.js"><link rel="prefetch" href="/assets/js/72.0dee4533.js"><link rel="prefetch" href="/assets/js/73.72b757a5.js"><link rel="prefetch" href="/assets/js/74.5cc6a8e7.js"><link rel="prefetch" href="/assets/js/75.a3efa729.js"><link rel="prefetch" href="/assets/js/76.ee52fbb0.js"><link rel="prefetch" href="/assets/js/77.2c257317.js"><link rel="prefetch" href="/assets/js/78.831d9b7b.js"><link rel="prefetch" href="/assets/js/79.7940520a.js"><link rel="prefetch" href="/assets/js/8.7f9f9c54.js"><link rel="prefetch" href="/assets/js/80.2f951622.js"><link rel="prefetch" href="/assets/js/81.fb674315.js"><link rel="prefetch" href="/assets/js/82.b9069b51.js"><link rel="prefetch" href="/assets/js/83.d718aedc.js"><link rel="prefetch" href="/assets/js/84.95180f04.js"><link rel="prefetch" href="/assets/js/85.3253eaff.js"><link rel="prefetch" href="/assets/js/86.3663d770.js"><link rel="prefetch" href="/assets/js/87.0c11349f.js"><link rel="prefetch" href="/assets/js/88.f5fac9dc.js"><link rel="prefetch" href="/assets/js/89.5e9c86e8.js"><link rel="prefetch" href="/assets/js/9.759c07c6.js"><link rel="prefetch" href="/assets/js/90.faeb161a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fab77d47.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">牛初九博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/gzh/gzh.html" class="nav-link">
  公众号
</a></div><div class="nav-item"><a href="/es/es.html" class="nav-link">
  ES系列
</a></div><div class="nav-item"><a href="/rocket/rocket.html" class="nav-link">
  RocketMQ系列
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="慕课课程" class="dropdown-title"><span class="title">慕课课程</span> <span class="arrow down"></span></button> <button type="button" aria-label="慕课课程" class="mobile-dropdown-title"><span class="title">慕课课程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://coding.imooc.com/class/341.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  精讲分布式定时任务
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://class.imooc.com/sale/javaarchitect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java架构师直通车
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/gzh/gzh.html" class="nav-link">
  公众号
</a></div><div class="nav-item"><a href="/es/es.html" class="nav-link">
  ES系列
</a></div><div class="nav-item"><a href="/rocket/rocket.html" class="nav-link">
  RocketMQ系列
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="慕课课程" class="dropdown-title"><span class="title">慕课课程</span> <span class="arrow down"></span></button> <button type="button" aria-label="慕课课程" class="mobile-dropdown-title"><span class="title">慕课课程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://coding.imooc.com/class/341.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  精讲分布式定时任务
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://class.imooc.com/sale/javaarchitect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java架构师直通车
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/article/nacos.html" class="sidebar-link">注册中心Nacos集群搭建</a></li><li><a href="/article/nacos-1.html" class="sidebar-link">Nacos配置中心和服务的注册发现</a></li><li><a href="/article/login.html" class="sidebar-link">怎样实现登录？| Cookie or JWT</a></li><li><a href="/article/oauth.html" class="sidebar-link">OAuth授权</a></li><li><a href="/article/sso.html" class="sidebar-link">SSO单点登录流程</a></li><li><a href="/article/front-back.html" class="sidebar-link">前后端分离 | 登录状态</a></li><li><a href="/article/MySQL+Keepalived.html" class="sidebar-link">MySQL+Keepalived高可用</a></li><li><a href="/article/mysql-ms.html" class="sidebar-link">MySQL主从同步配置</a></li><li><a href="/article/mysql-huan.html" class="sidebar-link">MySQL中的幻读，你真的理解吗？</a></li><li><a href="/article/db-pool.html" class="sidebar-link">数据库连接池数量设置为多少？</a></li><li><a href="/article/CSRF.html" class="sidebar-link">CSRF的原理与防御</a></li><li><a href="/article/redis-lock.html" class="sidebar-link">Redis分布式锁</a></li><li><a href="/article/limit.html" class="sidebar-link">MySql分页查询慢</a></li><li><a href="/article/taglib.html" class="sidebar-link">自制权限框架（一）jsp标签</a></li><li><a href="/article/annotation.html" class="sidebar-link">自制权限框架（二）注解</a></li><li><a href="/article/jmeter-1.html" class="sidebar-link">JMeter测试（一）</a></li><li><a href="/article/jmeter-2.html" class="sidebar-link">JMeter测试（二）</a></li><li><a href="/article/spring-security.html" class="sidebar-link">Spring Security实现RBAC权限管理</a></li><li><a href="/article/nginx1.html" class="sidebar-link">Nginx简介（一）</a></li><li><a href="/article/nginx2.html" class="sidebar-link">Nginx简介（二）</a></li><li><a href="/article/string.html" class="sidebar-link">String是值传递还是引用传递</a></li><li><a href="/article/redis-cluster.html" class="sidebar-link">Redis集群</a></li><li><a href="/article/cas.html" class="sidebar-link">CAS与OAuth2的区别</a></li><li><a href="/article/spring-eureka-2.html" class="sidebar-link">Eureka服务注册与发现</a></li><li><a href="/article/spring-mobile.html" class="sidebar-link">Spring Mobile</a></li><li><a href="/article/es-1.html" class="sidebar-link">ES学习（一）ES的安装与启动</a></li><li><a href="/article/es-2.html" class="sidebar-link">ES学习（二）ES的集群原理</a></li><li><a href="/article/es-3.html" class="sidebar-link">ES学习（三）新建索引</a></li><li><a href="/article/es-4.html" class="sidebar-link">ES学习（四）字段类型（mapping）</a></li><li><a href="/article/es-5.html" class="sidebar-link">ES学习（五）动态映射</a></li><li><a href="/article/es-6.html" class="sidebar-link">ES学习（六）分析器</a></li><li><a href="/article/es-7.html" class="sidebar-link">ES学习（七）IK中文分词器</a></li><li><a href="/article/es-8.html" class="sidebar-link">ES学习（八）数据的增删改</a></li><li><a href="/article/es-9.html" class="sidebar-link">ES学习（九）搜索</a></li><li><a href="/article/es-10.html" class="sidebar-link">ES学习（十）聚合查询</a></li><li><a href="/article/es-11.html" class="sidebar-link">ES学习（十一）与SpringBoot结合</a></li><li><a href="/article/es-12.html" class="sidebar-link">ES学习（十二）高亮 和 搜索建议</a></li><li><a href="/article/es-13.html" class="sidebar-link">ES学习（十三）GEO位置搜索</a></li><li><a href="/article/rocketmq-1.html" class="sidebar-link">RocketMQ系列（一）基本概念</a></li><li><a href="/article/rocketmq-2.html" class="sidebar-link">RocketMQ系列（二）环境搭建</a></li><li><a href="/article/rocketmq-3.html" class="sidebar-link">RocketMQ系列（三）消息的生产与消费</a></li><li><a href="/article/rocketmq-4.html" class="sidebar-link">RocketMQ系列（四）顺序消费</a></li><li><a href="/article/rocketmq-5.html" class="sidebar-link">RocketMQ系列（五）广播与延迟消息</a></li><li><a href="/article/rocketmq-6.html" class="sidebar-link">RocketMQ系列（六）批量发送与过滤</a></li><li><a href="/article/rocketmq-7.html" class="sidebar-link">RocketMQ系列（七）事务消息</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mongodb之副本集-返回"><a href="#mongodb之副本集-返回" class="header-anchor">#</a> MongoDB之副本集   <a href="/" title="首页" class="router-link-active">返回</a></h1> <h2 id="一、简介"><a href="#一、简介" class="header-anchor">#</a> 一、简介</h2> <p>MongoDB 是一个基于分布式文件存储的数据库。由 C++ 语言编写。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。</p> <p>MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。</p> <h3 id="_1-1副本集-replication"><a href="#_1-1副本集-replication" class="header-anchor">#</a> 1.1副本集（replication）</h3> <p>MongoDB 副本集是一组mongod的进程，它们保存着相同的数据集。副本集提供了冗余和高可用，这是所有生产环境部署的基础。在不同的数据库服务中，存在着相同的数据，它提供了一定级别的容灾，避免了单点故障。在一些情况下副本可以提供读的能力，客户端发来的读请求可以分配到不同的服务上。一个副本集包含几个数据承载节点和随意的一个仲裁节点。数据承载节点中，只能有一个成员是主节点（primary），其他的节点都是从节点（secondary）。一个副本集中只用主节点有确认写的能力，主节点在oplog中记录下所有数据的变化，从节点复制主节点的oplog，并执行这些操作。这样，从节点的数据与主节点保持一致。如果主节点不可用，从节点中将会选举出新的主节点。</p> <p><img src="https://images2017.cnblogs.com/blog/1191201/201802/1191201-20180208150129576-1480106071.png" alt="image1"></p> <h3 id="_1-2仲裁者-arbiter"><a href="#_1-2仲裁者-arbiter" class="header-anchor">#</a> 1.2仲裁者（arbiter）</h3> <p>你可以向副本集中添加额外的mongod实例作为仲裁者（arbiter）。仲裁者不保存数据，它只在心跳响应中和选举请求中作为一个法定人数。由于仲裁节点不保存数据，所以相比数据节点，它占用更少的资源。如果你的数据集有偶数个节点，添加一个仲裁者节点可以保持选举中的多数票。</p> <p><img src="https://images2017.cnblogs.com/blog/1191201/201802/1191201-20180208151306045-768907567.png" alt="image2"></p> <h3 id="_1-3自动故障转移-automatic-failover"><a href="#_1-3自动故障转移-automatic-failover" class="header-anchor">#</a> 1.3自动故障转移（Automatic Failover）</h3> <p>当主节点不能和其他成员节点通信，超过10秒时，一个合法的从节点将举行选举，选举它自己为新的主节点，第一个进行选举的从节点如果收到了大多数的选票，它将成为新的主节点。失效转移的过程大概会在1分钟内完成，例如，副本集中的成员发现主节点不可用将花费10-30秒时间，其余的从节点选举出新的主节点花费10-30秒时间。</p> <p><img src="https://images2017.cnblogs.com/blog/1191201/201802/1191201-20180208152448216-1282500041.png" alt="image3"></p> <h3 id="_1-4-优先级为0的数据集成员"><a href="#_1-4-优先级为0的数据集成员" class="header-anchor">#</a> 1.4 优先级为0的数据集成员</h3> <p>一个优先级为0的成员不能成为主节点，也不能触发选举。除了这个限制，它和其他的从节点功能一样，保持数据复制，接受读操作，在选举中投票。配置优先级为0的从节点，经常用于多数据中心的部署。例如，一个数据中心拥有一个主节点和一个从节点，第二个数据中心拥有一个优先级为0的从节点，这样，只有第一个数据中心的成员可以成为主节点。</p> <p><img src="https://images2017.cnblogs.com/blog/1191201/201802/1191201-20180208153632810-493957590.png" alt="image4"></p> <h3 id="_1-5-隐藏的数据集成员"><a href="#_1-5-隐藏的数据集成员" class="header-anchor">#</a> 1.5 隐藏的数据集成员</h3> <p>隐藏成员复制主节点的数据，但是它对于客户端的节点是不可见的。隐藏成员必须是优先级为0的，它不能成为主节点。db.isMaster()方法不能显示隐藏成员，但是隐藏成员可以在选举中进行选举。在下面5成员的副本集中，4个从节点复制主节点的数据，但是一个从节点是隐藏的。</p> <p><img src="https://images2017.cnblogs.com/blog/1191201/201802/1191201-20180208171115154-981676483.png" alt="image5"></p> <h2 id="二、部署副本集"><a href="#二、部署副本集" class="header-anchor">#</a> 二、部署副本集</h2> <h3 id="_2-1-部署副本集"><a href="#_2-1-部署副本集" class="header-anchor">#</a> 2.1 部署副本集</h3> <p>3个成员的副本集提供了足够的冗余以避免更多的网络分裂和其他的系统失败。这个集合有足够的能力处理更多的分布读操作。副本集应该总是有奇数个成员，这可以使得选举过程更顺利。在生产环境部署时，你应该保持每一个mongod实例在一个单独的机器上，当使用虚拟机时，你应该保持每一个mongod实例在一个独立的主机服务上。</p> <p>从MongoDB官网下载package，上传到3台机器上。我们这台机器的ip为192.168.2.233，192.168.2.234，192.168.2.235，上传的目录是/usr/local。</p> <p>解压：</p> <div class="language- extra-class"><pre class="language-text"><code>tar -zxvf mongodb-linux-x86_64-rhel70-3.6.2.tgz
</code></pre></div><p>MongoDB的数据存储在data目录的db目录下，但是这个目录在安装过程不会自动创建，所以你需要手动创建data目录，并在data目录中创建db目录。</p> <div class="language- extra-class"><pre class="language-text"><code>mkdir -p /data/db
</code></pre></div><p>我们再创建/data/conf目录，存储MongoDB的配置文件</p> <div class="language- extra-class"><pre class="language-text"><code>mkdir /data/confvim mongod.conf
</code></pre></div><p>配置的内容如下：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">replication</span><span class="token punctuation">:</span>
   <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> <span class="token string">&quot;rs0&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
   <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> 192.168.2.233
</code></pre></div><p>replSetName设置副本集的名称，这里我们设置为“rs0”，bindIp设置为本机的ip，3台机器的mongod实例设置为自己的ip。</p> <p>然后，我们在3台机器上，分别启动mongod实例</p> <div class="language- extra-class"><pre class="language-text"><code>./bin/mongod --config /data/conf/mongod.conf
</code></pre></div><p>mongod启动的默认端口是27017。</p> <p>使用mongo shell连接3个mongod实例中的一个</p> <div class="language- extra-class"><pre class="language-text"><code>./bin/mongo --host 192.168.2.233
</code></pre></div><p>然后执行如下命令，设置副本集：</p> <div class="language- extra-class"><pre class="language-text"><code>rs.initiate( {
   _id : &quot;rs0&quot;,
   members: [
      { _id: 0, host: &quot;192.168.2.233:27017&quot; },
      { _id: 1, host: &quot;192.168.2.234:27017&quot; },
      { _id: 2, host: &quot;192.168.2.235:27017&quot; }
   ]
})
</code></pre></div><p>这样，3个成员的副本集就设置完成了。</p> <p>查看副本集的配置，运行如下命令：</p> <div class="language- extra-class"><pre class="language-text"><code>rs.conf()
</code></pre></div><p>返回的结果如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
   <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;rs0&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;version&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
   <span class="token property">&quot;protocolVersion&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">1</span>)<span class="token punctuation">,</span>
   <span class="token property">&quot;members&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
         <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
         <span class="token property">&quot;host&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;192.168.2.233:27017&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;arbiterOnly&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
         <span class="token property">&quot;buildIndexes&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
         <span class="token property">&quot;hidden&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
         <span class="token property">&quot;priority&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
         <span class="token property">&quot;tags&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
 
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token property">&quot;slaveDelay&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">0</span>)<span class="token punctuation">,</span>
         <span class="token property">&quot;votes&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
         <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
         <span class="token property">&quot;host&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;192.168.2.234:27017&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;arbiterOnly&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
         <span class="token property">&quot;buildIndexes&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
         <span class="token property">&quot;hidden&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
         <span class="token property">&quot;priority&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
         <span class="token property">&quot;tags&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
 
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token property">&quot;slaveDelay&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">0</span>)<span class="token punctuation">,</span>
         <span class="token property">&quot;votes&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
         <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
         <span class="token property">&quot;host&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;192.168.2.235:27017&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;arbiterOnly&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
         <span class="token property">&quot;buildIndexes&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
         <span class="token property">&quot;hidden&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
         <span class="token property">&quot;priority&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
         <span class="token property">&quot;tags&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
 
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token property">&quot;slaveDelay&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">0</span>)<span class="token punctuation">,</span>
         <span class="token property">&quot;votes&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
 
   <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token property">&quot;settings&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;chainingAllowed&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;heartbeatIntervalMillis&quot;</span> <span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
      <span class="token property">&quot;heartbeatTimeoutSecs&quot;</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token property">&quot;electionTimeoutMillis&quot;</span> <span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
      <span class="token property">&quot;catchUpTimeoutMillis&quot;</span> <span class="token operator">:</span> <span class="token number">-1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;getLastErrorModes&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
 
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;getLastErrorDefaults&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token property">&quot;w&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
         <span class="token property">&quot;wtimeout&quot;</span> <span class="token operator">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;replicaSetId&quot;</span> <span class="token operator">:</span> ObjectId(<span class="token string">&quot;585ab9df685f726db2c6a840&quot;</span>)
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>确定副本集的主节点，运行如下命令：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;set&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;rs0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;date&quot;</span> <span class="token operator">:</span> ISODate(<span class="token string">&quot;2018-02-08T11:08:15.457Z&quot;</span>)<span class="token punctuation">,</span>
    <span class="token property">&quot;myState&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;term&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">2</span>)<span class="token punctuation">,</span>
    <span class="token property">&quot;heartbeatIntervalMillis&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">2000</span>)<span class="token punctuation">,</span>
    <span class="token property">&quot;optimes&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;lastCommittedOpTime&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;ts&quot;</span> <span class="token operator">:</span> Timestamp(<span class="token number">1518088089</span><span class="token punctuation">,</span> <span class="token number">1</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;t&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">2</span>)
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;readConcernMajorityOpTime&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;ts&quot;</span> <span class="token operator">:</span> Timestamp(<span class="token number">1518088089</span><span class="token punctuation">,</span> <span class="token number">1</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;t&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">2</span>)
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;appliedOpTime&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;ts&quot;</span> <span class="token operator">:</span> Timestamp(<span class="token number">1518088089</span><span class="token punctuation">,</span> <span class="token number">1</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;t&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">2</span>)
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;durableOpTime&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;ts&quot;</span> <span class="token operator">:</span> Timestamp(<span class="token number">1518088089</span><span class="token punctuation">,</span> <span class="token number">1</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;t&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">2</span>)
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;members&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;192.168.2.233:27017&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;health&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">&quot;state&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">&quot;stateStr&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;PRIMARY&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;uptime&quot;</span> <span class="token operator">:</span> <span class="token number">67</span><span class="token punctuation">,</span>
            <span class="token property">&quot;optime&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;ts&quot;</span> <span class="token operator">:</span> Timestamp(<span class="token number">1518088089</span><span class="token punctuation">,</span> <span class="token number">1</span>)<span class="token punctuation">,</span>
                <span class="token property">&quot;t&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">2</span>)
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;optimeDate&quot;</span> <span class="token operator">:</span> ISODate(<span class="token string">&quot;2018-02-08T11:08:09Z&quot;</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;electionTime&quot;</span> <span class="token operator">:</span> Timestamp(<span class="token number">1518088058</span><span class="token punctuation">,</span> <span class="token number">1</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;electionDate&quot;</span> <span class="token operator">:</span> ISODate(<span class="token string">&quot;2018-02-08T11:07:38Z&quot;</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;configVersion&quot;</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token property">&quot;self&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;192.168.2.234:27017&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;health&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">&quot;state&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token property">&quot;stateStr&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;SECONDARY&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;uptime&quot;</span> <span class="token operator">:</span> <span class="token number">46</span><span class="token punctuation">,</span>
            <span class="token property">&quot;optime&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;ts&quot;</span> <span class="token operator">:</span> Timestamp(<span class="token number">1518088089</span><span class="token punctuation">,</span> <span class="token number">1</span>)<span class="token punctuation">,</span>
                <span class="token property">&quot;t&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">2</span>)
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;optimeDurable&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;ts&quot;</span> <span class="token operator">:</span> Timestamp(<span class="token number">1518088089</span><span class="token punctuation">,</span> <span class="token number">1</span>)<span class="token punctuation">,</span>
                <span class="token property">&quot;t&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">2</span>)
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;optimeDate&quot;</span> <span class="token operator">:</span> ISODate(<span class="token string">&quot;2018-02-08T11:08:09Z&quot;</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;optimeDurableDate&quot;</span> <span class="token operator">:</span> ISODate(<span class="token string">&quot;2018-02-08T11:08:09Z&quot;</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;lastHeartbeat&quot;</span> <span class="token operator">:</span> ISODate(<span class="token string">&quot;2018-02-08T11:08:14.473Z&quot;</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;lastHeartbeatRecv&quot;</span> <span class="token operator">:</span> ISODate(<span class="token string">&quot;2018-02-08T11:08:14.829Z&quot;</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;pingMs&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">0</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;syncingTo&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;192.168.2.233:27017&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;configVersion&quot;</span> <span class="token operator">:</span> <span class="token number">3</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;192.168.2.235:27017&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;health&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">&quot;state&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token property">&quot;stateStr&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;SECONDARY&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;uptime&quot;</span> <span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
            <span class="token property">&quot;optime&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;ts&quot;</span> <span class="token operator">:</span> Timestamp(<span class="token number">1518088089</span><span class="token punctuation">,</span> <span class="token number">1</span>)<span class="token punctuation">,</span>
                <span class="token property">&quot;t&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">2</span>)
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;optimeDurable&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;ts&quot;</span> <span class="token operator">:</span> Timestamp(<span class="token number">1518088089</span><span class="token punctuation">,</span> <span class="token number">1</span>)<span class="token punctuation">,</span>
                <span class="token property">&quot;t&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">2</span>)
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;optimeDate&quot;</span> <span class="token operator">:</span> ISODate(<span class="token string">&quot;2018-02-08T11:08:09Z&quot;</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;optimeDurableDate&quot;</span> <span class="token operator">:</span> ISODate(<span class="token string">&quot;2018-02-08T11:08:09Z&quot;</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;lastHeartbeat&quot;</span> <span class="token operator">:</span> ISODate(<span class="token string">&quot;2018-02-08T11:08:14.474Z&quot;</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;lastHeartbeatRecv&quot;</span> <span class="token operator">:</span> ISODate(<span class="token string">&quot;2018-02-08T11:08:15.020Z&quot;</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;pingMs&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">0</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;syncingTo&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;192.168.2.234:27017&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;configVersion&quot;</span> <span class="token operator">:</span> <span class="token number">3</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ok&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;operationTime&quot;</span> <span class="token operator">:</span> Timestamp(<span class="token number">1518088089</span><span class="token punctuation">,</span> <span class="token number">1</span>)<span class="token punctuation">,</span>
    <span class="token property">&quot;$clusterTime&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;clusterTime&quot;</span> <span class="token operator">:</span> Timestamp(<span class="token number">1518088089</span><span class="token punctuation">,</span> <span class="token number">1</span>)<span class="token punctuation">,</span>
        <span class="token property">&quot;signature&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;hash&quot;</span> <span class="token operator">:</span> BinData(<span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;</span>)<span class="token punctuation">,</span>
            <span class="token property">&quot;keyId&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token number">0</span>)
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们从返回的结果中，可以看到每个节点的状态。</p> <h3 id="_2-2-添加仲裁者节点"><a href="#_2-2-添加仲裁者节点" class="header-anchor">#</a> 2.2 添加仲裁者节点</h3> <p>警告：一个副本集的仲裁者节点不要超过一个。</p> <p>首先，为仲裁者节点创建数据库目录</p> <div class="language- extra-class"><pre class="language-text"><code>mkdir /data/arb
</code></pre></div><p>以副本集的方式启动仲裁者节点，并制定数据库目录：</p> <div class="language- extra-class"><pre class="language-text"><code>mongod --port 27017 --dbpath /data/arb --replSet rs0 --bind_ip 192.168.2.236
</code></pre></div><p>向副本集中加入仲裁者，只有连接主节点才能加入仲裁者节点，前面的例子中，我们的主节点是192.168.2.233，然后执行如下命令：</p> <div class="language- extra-class"><pre class="language-text"><code>rs.addArb(&quot;192.168.2.236:27017&quot;)
</code></pre></div><p>至此，创建副本集就介绍完了，希望对大家有帮助。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.16ffb530.js" defer></script><script src="/assets/js/2.2805d820.js" defer></script><script src="/assets/js/57.0a78afcc.js" defer></script>
  </body>
</html>
