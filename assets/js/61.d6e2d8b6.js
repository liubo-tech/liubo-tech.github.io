(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{482:function(s,a,e){"use strict";e.r(a);var t=e(42),l=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"mysql主从同步配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql主从同步配置"}},[s._v("#")]),s._v(" MySQL主从同步配置")]),s._v(" "),e("p",[s._v("1.编辑MySQL"),e("strong",[s._v("主")]),s._v("上的/etc/my.cnf，")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("log-bin"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("imooc_mysql\nserver-id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),e("ul",[e("li",[e("code",[s._v("log-bin")]),s._v("：MySQL的bin-log的名字")]),s._v(" "),e("li",[e("code",[s._v("server-id")]),s._v(": MySQL实例中全局唯一，并且大于0。")])]),s._v(" "),e("p",[s._v("2.编辑MySQL"),e("strong",[s._v("从")]),s._v("上的/etc/my.cnf，")]),s._v(" "),e("div",{staticClass:"language-she extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server-id=2\n")])])]),e("ul",[e("li",[e("code",[s._v("server-id")]),s._v(": MySQL实例中全局唯一，并且大于0。与主上的"),e("code",[s._v("server-id")]),s._v("区分开。")])]),s._v(" "),e("p",[s._v("3.在MySQL"),e("strong",[s._v("主")]),s._v("上创建用于备份账号")]),s._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mysql> CREATE USER 'repl'@'%' IDENTIFIED BY 'password';\nmysql> GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%';\n")])])]),e("p",[s._v("4.MySQL"),e("strong",[s._v("主")]),s._v("上加锁，阻止所有的写入操作")]),s._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mysql> FLUSH TABLES WITH READ LOCK;\n")])])]),e("p",[s._v("5.MySQL"),e("strong",[s._v("主")]),s._v("上，查看bin-log的文件名和位置")]),s._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mysql > SHOW MASTER STATUS;\n")])])]),e("p",[s._v("6.MySQL"),e("strong",[s._v("主")]),s._v("上dump所有数据，")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("mysqldump --all-databases --master-data "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" dbdump.db -uroot -p\n")])])]),e("p",[s._v("7.MySQL"),e("strong",[s._v("主")]),s._v("进行解锁，解锁后，主上可以写入数据")]),s._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mysql> UNLOCK TABLES;\n")])])]),e("p",[s._v("8.MySQL"),e("strong",[s._v("从")]),s._v("上导入之前dump的数据")]),s._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mysql < aa.db -uroot -p\n")])])]),e("p",[s._v("9.MySQL"),e("strong",[s._v("从")]),s._v("上配置主从连接信息")]),s._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mysql> CHANGE MASTER TO\n    ->     MASTER_HOST='master_host_name',\n    ->     MASTER_PORT=port_num\n    ->     MASTER_USER='replication_user_name',\n    ->     MASTER_PASSWORD='replication_password',\n    ->     MASTER_LOG_FILE='recorded_log_file_name',\n    ->     MASTER_LOG_POS=recorded_log_position;\n")])])]),e("ul",[e("li",[e("code",[s._v("master_host_name")]),s._v(": MySQL主的地址")]),s._v(" "),e("li",[e("code",[s._v("port_num")]),s._v(": MySQL主的端口（数字型）")]),s._v(" "),e("li",[e("code",[s._v("replication_user_name")]),s._v(":  备份账户的用户名")]),s._v(" "),e("li",[e("code",[s._v("replication_password")]),s._v(": 备份账户的密码")]),s._v(" "),e("li",[e("code",[s._v("recorded_log_file_name")]),s._v("：bin-log的文件名")]),s._v(" "),e("li",[e("code",[s._v("recorded_log_position")]),s._v(": bin-log的位置（数字型）")])]),s._v(" "),e("p",[s._v("bin-log的文件名和位置 是 步骤5中的"),e("code",[s._v("show master status")]),s._v("得到的。")]),s._v(" "),e("p",[s._v("10.MySQL"),e("strong",[s._v("从")]),s._v("上开启同步")]),s._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mysql> START SLAVE;\n")])])]),e("p",[s._v("查看MySQL"),e("strong",[s._v("从")]),s._v("的状态")]),s._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("show slave status;\n")])])])])}),[],!1,null,null,null);a.default=l.exports}}]);