(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{484:function(s,a,t){"use strict";t.r(a);var e=t(42),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"注册中心nacos集群搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注册中心nacos集群搭建"}},[s._v("#")]),s._v(" 注册中心Nacos集群搭建")]),s._v(" "),t("p",[s._v("一提到注册中心，大家往往想到Zookeeper、或者Eureka。今天我们看看阿里的一款配置中心+注册中心的中间件——Nacos。有了它以后，我们的项目中的配置就可以统一从Nacos中获取了，而且Spring Cloud的提供者和消费者还可以使用它做注册发现中心。")]),s._v(" "),t("p",[s._v("在搭建Nacos的时候，为了保证高可用，我们要采用的集群的方式搭建。")]),s._v(" "),t("p",[s._v("首先，我们要在数据库中创建一些Nacos的表，Sql文件可以点击下面的链接下载，")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/alibaba/nacos/blob/master/distribution/conf/nacos-mysql.sql",target:"_blank",rel:"noopener noreferrer"}},[s._v("Sql文件"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("然后，我们再下载Nacos的压缩包，连接如下：")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/alibaba/nacos/releases/download/1.3.0/nacos-server-1.3.0.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v("tar.gz包"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("将下载好的压缩包分别上传到3个服务器上，在我们这里3台机器分别是192.168.73.141，192.168.73.142，192.168.73.143，然后进行解压，")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf nacos-server-1.3.2.tar.gz\n")])])]),t("p",[s._v("然后，我们进入到conf目录，修改配置，如下：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" application.properties\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#*************** Config Module Related Configurations ***************#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 数据源指定MySQL")]),s._v("\nspring.datasource.platform"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 数据库的数量:")]),s._v("\ndb.num"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 数据库连接 IP 端口 数据库名称需要改成自己的")]),s._v("\ndb.url.0"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jdbc:mysql://192.168.73.150:3306/nacos_config?characterEncoding"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connectTimeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("socketTimeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("autoReconnect")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("useUnicode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("useSSL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("serverTimezone")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("UTC\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 用户名")]),s._v("\ndb.user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("user\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 密码")]),s._v("\ndb.password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("youdontknow\n")])])]),t("p",[s._v("这里我们主要修改数据库的配置，然后再看看集群的配置，如下：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 将示例文件改为集群配置文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" cluster.conf.example cluster.conf\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" cluster.conf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 将3个机器的IP和端口写到集群配置文件中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".73.141:8848\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".73.142:8848\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".73.143:8848\n")])])]),t("p",[s._v("好了，到这里，Nacos的集群就配置好了，简单吧，然后我们分别启动3台机器上的Nacos，进入到Nacos的主目录，执行如下命令，")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/start.sh\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 查看每台机器上的启动日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -500f logs/start.log\n")])])]),t("p",[s._v("我们可以看到Nacos启动成功的日志。好了，到这里Nacos集群就搭建完成了。")]),s._v(" "),t("p",[s._v("剩下的事情就是在这3台机器之间做负载均衡了，方案也有很多，可以使用Nginx、HAProxy、Keepalived+LVS等。这里就不给大家做过多的介绍了，比较简单的，我们可以使用Nginx，然后配置HOST进行访问。")])])}),[],!1,null,null,null);a.default=r.exports}}]);