(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{493:function(s,a,e){"use strict";e.r(a);var t=e(42),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"rocketmq系列-二-环境搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq系列-二-环境搭建"}},[s._v("#")]),s._v(" RocketMQ系列（二）环境搭建")]),s._v(" "),e("p",[s._v("RocketMQ的基本概念在上一篇中给大家介绍了，这一节将给大家介绍环境搭建。RocketMQ中最基础的就是NameServer，我们先来看看它是怎么搭建的。")]),s._v(" "),e("h2",{attrs:{id:"nameserver"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nameserver"}},[s._v("#")]),s._v(" NameServer")]),s._v(" "),e("p",[s._v("RocketMQ要求的环境是JDK8以上，我们先检查一下环境，")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centOS-1 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# java -version")]),s._v("\nopenjdk version "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"11.0.3"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-04-16 LTS\nOpenJDK Runtime Environment "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.9")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.0")]),s._v(".3+7-LTS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nOpenJDK "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("-Bit Server VM "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.9")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.0")]),s._v(".3+7-LTS, mixed mode, sharing"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),e("p",[s._v("我的这个机器并没有刻意的安装JDK，而是系统自带的OpenJDK 11，这应该也是没有问题的。然后我们从RocketMQ官网下载最新的安装包，并且上传到"),e("code",[s._v("/opt")]),s._v("目录下，")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centOS-1 opt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\n-rw-r--r--.  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root  root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("13838456")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("月   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" 08:49 rocketmq-all-4.7.0-bin-release.zip\n\n")])])]),e("p",[s._v("然后我们解压这个zip包，")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centOS-1 opt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unzip rocketmq-all-4.7.0-bin-release.zip")]),s._v("\n")])])]),e("p",[s._v("这里使用的是unzip命令，如果你的机器里没有这个命令，可以使用"),e("code",[s._v("yum install")]),s._v("安装一个。解压以后，进入到RocketMQ的主目录，并且启动一下NameServer。")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centOS-1 opt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd rocketmq-all-4.7.0-bin-release")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centOS-1 rocketmq-all-4.7.0-bin-release"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./bin/mqnamesrv")]),s._v("\nOpenJDK "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" version "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.0")]),s._v(" and will likely be removed "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" a future release.\nUnrecognized VM option "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'UseCMSCompactAtFullCollection'")]),s._v("\nError: Could not create the Java Virtual Machine.\nError: A fatal exception has occurred. Program will exit.\n\n")])])]),e("p",[s._v("这里出了一个错误"),e("code",[s._v("Error: Could not create the Java Virtual Machine")]),s._v("，这是由于RocketMQ的启动文件都是按照JDK8配置的，而我们这里使用的是OpenJDK11，有很多命令参数不支持导致的，如果小伙伴们使用的是JDK8，正常启动是没有问题的。")]),s._v(" "),e("p",[s._v("在这里我们改一下RocketMQ的启动文件，")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centOS-1 rocketmq-all-4.7.0-bin-release"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim bin/runserver.sh ")]),s._v("\n")])])]),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" JAVA_HOME\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v('/bin/java"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BASE_DIR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("dirname")]),s._v(" $0"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("/"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在CLASSPATH中添加RocketMQ的lib目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#export CLASSPATH=.:${BASE_DIR}/conf:${CLASSPATH}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLASSPATH")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BASE_DIR}")]),s._v("/lib/*:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BASE_DIR}")]),s._v("/conf:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CLASSPATH}")]),s._v("\n")])])]),e("p",[s._v("修改的地方我们增加了注释，在ClassPath里添加了lib目录，然后在这个文件的末尾，注释掉升级JDK后不支持的几个参数，")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -server -Xms4g -Xmx4g -Xmn2g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#JAVA_OPT="${JAVA_OPT} -XX:+UseConcMarkSweepGC -XX:+UseCMSCompactAtFullCollection -XX:CMSInitiatingOccupancyFraction=70 -XX:+CMSParallelRemarkEnabled -XX:SoftRefLRUPolicyMSPerMB=0 -XX:+CMSClassUnloadingEnabled -XX:SurvivorRatio=8  -XX:-UseParNewGC"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(" -verbose:gc -Xloggc:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${GC_LOG_DIR}")]),s._v('/rmq_srv_gc_%p_%t.log -XX:+PrintGCDetails"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#JAVA_OPT="${JAVA_OPT} -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=30m"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -XX:-OmitStackTraceInFastThrow"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -XX:-UseLargePages"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#JAVA_OPT="${JAVA_OPT} -Djava.ext.dirs=${JAVA_HOME}/jre/lib/ext:${BASE_DIR}/lib"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#JAVA_OPT="${JAVA_OPT} -Xdebug -Xrunjdwp:transport=dt_socket,address=9555,server=y,suspend=n"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT_EXT}")]),s._v('"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(" -cp "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CLASSPATH}")]),s._v('"')]),s._v("\n\n")])])]),e("p",[s._v("好了，修改完以后，我们保存退出，再次启动，这次我们在后台启动NameServer，")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centOS-1 rocketmq-all-4.7.0-bin-release"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nohup ./bin/mqnamesrv &")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centOS-1 rocketmq-all-4.7.0-bin-release"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tail -500f ~/logs/rocketmqlogs/namesrv.log ")]),s._v("\n\n")])])]),e("p",[s._v("然后查看一下日志，在日志中看到"),e("code",[s._v("main - The Name Server boot success. serializeType=JSON")]),s._v("，说明NameServer启动成功了。")]),s._v(" "),e("p",[s._v("单点的NameServer肯定是不能满足我们的要求的，怎么也要做个集群吧。NameServer是一个无状态的服务，节点之间没有任何数据往来，所以NameServer的集群搭建不需要任何的配置，只需要启动多个NameServer服务就可以了，它不像Zookeeper集群搭建那样，需要配置各个节点。在这里我们就启动3个NameServer节点吧，对应我们的3台机器，"),e("code",[s._v("192.168.73.130,192.168.73.131,192.168.73.132")]),s._v("。")]),s._v(" "),e("h2",{attrs:{id:"broker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#broker"}},[s._v("#")]),s._v(" Broker")]),s._v(" "),e("p",[s._v("NameServer集群搭建完成，下面就搭建Broker了，Broker呢，我们要搭建一个两主两从结构的，主从之间异步备份，保存磁盘也是使用异步的方式。如果你对主从同步和保存磁盘的方式还不了解，看看上一节的内容吧。异步两主两从这种结构的配置，在RocketMQ中已经有例子了，我们先一下配置文件。")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@centOS-1 rocketmq-all-4.7.0-bin-release"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim conf/2m-2s-async/broker-a.properties ")]),s._v("\n")])])]),e("p",[s._v("这个配置文件是"),e("code",[s._v("broker-a")]),s._v("“主”的配置文件，")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerClusterName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("RocketMQ-Cluster\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerId")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("deleteWhen")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("04\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fileReservedTime")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerRole")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ASYNC_MASTER\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flushDiskType")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ASYNC_FLUSH\n")])])]),e("p",[s._v("其中，")]),s._v(" "),e("ul",[e("li",[s._v("brokerClusterName是MQ集群的名称，我们改为RocketMQ-Cluster。")]),s._v(" "),e("li",[s._v("brokerName是队列的名字，配置为broker-a。")]),s._v(" "),e("li",[s._v("brokerId是队列的id，0代表是“主”，其他正整数代表着“从”。")]),s._v(" "),e("li",[s._v("deleteWhen=04 代表着commitLog过期了，就会被删除。")]),s._v(" "),e("li",[s._v("fileReservedTime是commitLog的过期时间，单位是小时，这里配置的是48小时。")]),s._v(" "),e("li",[s._v("brokerRole，队列的角色，ASYNC_MASTER是异步主。")]),s._v(" "),e("li",[s._v("flushDiskType，保存磁盘的方式，异步保存。")])]),s._v(" "),e("p",[s._v("再看看broker-a的从配置，")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerClusterName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("RocketMQ-Cluster\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerId")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("deleteWhen")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("04\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fileReservedTime")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerRole")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SLAVE\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flushDiskType")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ASYNC_FLUSH\n")])])]),e("p",[s._v("其中，集群的名字一样，队列的名字一样，只是brokerId和brokerRole不一样，这里的配置代表着它是队列broker-a的“从”。broker-b的配置和broker-a是一样的，只是brokerName不一样而已，在这里就不贴出来了。")]),s._v(" "),e("p",[s._v("两主两从的配置文件都已经配置好了，我们来规划一下，我们的NameServer是3台"),e("code",[s._v("192.168.73.130,192.168.73.131,192.168.73.132")]),s._v("，broker按照如下部署：")]),s._v(" "),e("ul",[e("li",[s._v("broker-a（主）：192.168.73.130")]),s._v(" "),e("li",[s._v("broker-a（从）：192.168.73.131")]),s._v(" "),e("li",[s._v("broker-b（主）：192.168.73.131")]),s._v(" "),e("li",[s._v("broker-b（从）：192.168.73.130")])]),s._v(" "),e("p",[s._v("接下来，我们启动broker，在"),e("code",[s._v("192.168.73.130")]),s._v("上启动 broker-a（主）和broker-b（从）。和NameServer一样，我们需要修改一下启动的脚本，否则也会报错误。我们修改的是"),e("code",[s._v("runbroker.sh")]),s._v("这个文件，修改的内容和前面是一样的，这里就不赘述了。在启动文件中，内存大小配置的是8g，如果机器的内存不够，可以适当减少一下内存。")]),s._v(" "),e("p",[s._v("这里还要做个说明，由于我们在一台机器上启动了两个broker实例，监听端口和日志存储的路径都会有冲突。那么我们在"),e("code",[s._v("192.168.73.130")]),s._v("的broker-b（从）的配置文件中，增加配置，如下：")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerClusterName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("RocketMQ-Cluster\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-b\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerId")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("deleteWhen")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("04\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fileReservedTime")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerRole")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SLAVE\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flushDiskType")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ASYNC_FLUSH\n\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenPort")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11911")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("storePathRootDir")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("~/store-b                       \n")])])]),e("p",[s._v("broker-b（从）的端口改为11911，区别默认的10911；storePathRootDir改为"),e("code",[s._v("~/store-b")]),s._v("，区分默认的"),e("code",[s._v("~/store")]),s._v("。")]),s._v(" "),e("p",[s._v("同样在"),e("code",[s._v("192.168.73.131")]),s._v("的broker-a（从）也要做修改，如下：")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerClusterName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("RocketMQ-Cluster\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerName")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("broker-a\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerId")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("deleteWhen")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("04\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fileReservedTime")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("brokerRole")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SLAVE\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flushDiskType")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ASYNC_FLUSH\n\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenPort")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11911")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("storePathRootDir")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("~/store-a\n\n")])])]),e("p",[s._v("然后，我们在"),e("code",[s._v("192.168.73.130")]),s._v("上启动，如下，")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./bin/mqbroker -c conf/2m-2s-async/broker-a.properties -n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.73.130:9876;192.168.73.131:9876;192.168.73.132:9876'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./bin/mqbroker -c conf/2m-2s-async/broker-b-s.properties -n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.73.130:9876;192.168.73.131:9876;192.168.73.132:9876'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\n")])])]),e("ul",[e("li",[s._v("-c 指定的是配置文件，分别指定的是broker-a（主）和broker-b（从）。")]),s._v(" "),e("li",[s._v("-n 指定的是NameServer的地址，指定了3个，用"),e("code",[s._v(",")]),s._v("隔开。")])]),s._v(" "),e("p",[s._v("再在"),e("code",[s._v("192.168.73.131")]),s._v("上启动，如下，")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./bin/mqbroker -c conf/2m-2s-async/broker-b.properties -n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.73.130:9876;192.168.73.131:9876;192.168.73.132:9876'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./bin/mqbroker -c conf/2m-2s-async/broker-a-s.properties -n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.73.130:9876;192.168.73.131:9876;192.168.73.132:9876'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),e("p",[s._v("好，如果没有出现错误，到这里，集群就搭建成功了。"),e("strong",[s._v("这里边有个小坑，大家一定要注意，就是-n后面的地址一定要用''括起来，并且地址之间要用"),e("code",[s._v(";")]),s._v("，否则，我们在查看集群列表时，是看不到的。")])]),s._v(" "),e("h2",{attrs:{id:"mqadmin"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mqadmin"}},[s._v("#")]),s._v(" mqadmin")]),s._v(" "),e("p",[s._v("集群已经搭建好了，我们可以查看一下集群的状态，查看集群的状态，我们可以使用mqadmin，命令如下：")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("./bin/mqadmin clusterlist -n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.73.130:9876;192.168.73.131:9876;192.168.73.132:9876'")]),s._v("\n")])])]),e("ul",[e("li",[s._v("clusterlist 是查看集群的命令")]),s._v(" "),e("li",[s._v("-n 后面是NameServer的地址，"),e("strong",[s._v("注意这里也要用''括起来，并且地址之间要用；隔开")])])]),s._v(" "),e("p",[s._v("执行结果如下：")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Cluster Name     #Broker Name            #BID  #Addr                  #Version                #InTPS(LOAD)       #OutTPS(LOAD) #PCWait(ms) #Hour #SPACE")]),s._v("\nRocketMQ-Cluster  broker-a                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".73.130:10911   V4_7_0                   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",0ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",0ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("442039.47")]),s._v(" -1.0000\nRocketMQ-Cluster  broker-a                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".73.131:11911   V4_7_0                   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",0ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",0ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("442039.47")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2956")]),s._v("\nRocketMQ-Cluster  broker-b                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".73.131:10911   V4_7_0                   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",0ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",0ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("442039.47")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2956")]),s._v("\nRocketMQ-Cluster  broker-b                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".73.130:11911   V4_7_0                   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",0ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",0ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("442039.47")]),s._v(" -1.0000\n\n")])])]),e("p",[s._v("我们可以看到在这个NameServer中心中，只有一个broker集群"),e("code",[s._v("RocketMQ-Cluster")]),s._v("，有两个broker，"),e("code",[s._v("broker-a")]),s._v("和"),e("code",[s._v("broker-b")]),s._v("，而且每一个broker都有主从，broker的ip我们也可以看到。")]),s._v(" "),e("p",[s._v("好了~ 到这里RocketMQ的集群就搭建好了，有问题评论区留言哦~~")])])}),[],!1,null,null,null);a.default=r.exports}}]);