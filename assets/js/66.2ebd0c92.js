(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{488:function(e,s,a){"use strict";a.r(s);var t=a(42),r=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"redis-cluster-集群-的搭建-返回"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-cluster-集群-的搭建-返回"}},[e._v("#")]),e._v(" Redis Cluster（集群）的搭建 "),a("RouterLink",{attrs:{to:"/",title:"首页"}},[e._v("返回")])],1),e._v(" "),a("h3",{attrs:{id:"一、redis的下载、安装、启动-单实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、redis的下载、安装、启动-单实例"}},[e._v("#")]),e._v(" 一、Redis的下载、安装、启动（单实例）")]),e._v(" "),a("p",[e._v("我们统一将Redis安装在/opt目录下，执行命令如下：")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ cd /opt\n$ wget http://download.redis.io/releases/redis-4.0.9.tar.gz\n$ tar zxvf redis-4.0.9.tar.gz\n$ cd redis-4.0.9\n$ make\n")])])]),a("p",[e._v("安装完成，下面我们启动Redis服务：")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ cd /opt/redis-4.0.9\n$ ./src/redis-server\n")])])]),a("p",[e._v("Redis启动成功，将采用Redis的默认配置。也可修改Redis根目录下的redis.conf文件，并在Redis启动时，指定配置文件，如下：")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ ./src/redis-server redis.conf\n")])])]),a("blockquote",[a("p",[e._v("注意，由于Redis的保护模式，只绑定了本机的127.0.0.1，从其他机器是不能访问的。所以我们需要添加本机的ip\n192.168.xxx.xxx。")])]),e._v(" "),a("h3",{attrs:{id:"二、redis-cluster-集群-的搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、redis-cluster-集群-的搭建"}},[e._v("#")]),e._v(" 二、Redis Cluster（集群）的搭建")]),e._v(" "),a("p",[e._v("由于我们的机器有限，我们将采用一台机器多个端口的方式搭建我们的Redis集群。")]),e._v(" "),a("p",[e._v("首先我们创建Redis的配置文件目录，如下：")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ cd /opt\n$ mkdir redis-cluster\n")])])]),a("p",[e._v("并在redis-cluster目录下创建6个节点的配置文件。分别为：")]),e._v(" "),a("ul",[a("li",[e._v("redis-7000.conf")]),e._v(" "),a("li",[e._v("redis-7001.conf")]),e._v(" "),a("li",[e._v("redis-7002.conf")]),e._v(" "),a("li",[e._v("redis-7003.conf")]),e._v(" "),a("li",[e._v("redis-7004.conf")]),e._v(" "),a("li",[e._v("redis-7005.conf")])]),e._v(" "),a("p",[e._v("后面的7000,7001等是redis启动的端口号。接下来编辑文件的内容：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("#该集群阶段的端口\nport 7000\n#为每一个集群节点指定一个pid_file\npidfile /var/run/redis_7000.pid\n#在bind指令后添加本机的ip\nbind 127.0.0.1 149.28.37.147\n#找到Cluster配置的代码段，使得Redis支持集群\ncluster-enabled yes\n#每一个集群节点都有一个配置文件，这个文件是不能手动编辑的。确保每一个集群节点的配置文件不通\ncluster-config-file nodes-7000.conf\n#集群节点的超时时间，单位：ms，超时后集群会认为该节点失败\ncluster-node-timeout 5000\n#最后将appendonly改成yes\nappendonly yes\n")])])]),a("p",[e._v("这样一个节点的配置就完成，其他的5个节点也做同样的配置。并将6个节点的Redis实例启动：")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ nohup /opt/redis-4.0.9/src/redis-server /opt/redis-cluster/redis-7000.conf &\n$ nohup /opt/redis-4.0.9/src/redis-server /opt/redis-cluster/redis-7001.conf &\n$ nohup /opt/redis-4.0.9/src/redis-server /opt/redis-cluster/redis-7002.conf &\n$ nohup /opt/redis-4.0.9/src/redis-server /opt/redis-cluster/redis-7003.conf &\n$ nohup /opt/redis-4.0.9/src/redis-server /opt/redis-cluster/redis-7004.conf &\n$ nohup /opt/redis-4.0.9/src/redis-server /opt/redis-cluster/redis-7005.conf &\n")])])]),a("p",[e._v("使用这6个节点创建集群：")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ /opt/redis-4.0.9/src/redis-trib.rb create --replicas 1 149.28.37.147:7000 149.28.37.147:7001 149.28.37.147:7002 149.28.37.147:7003 149.28.37.147:7004 149.28.37.147:7005\n")])])]),a("blockquote",[a("p",[e._v("--replicas 1 表示我们希望为集群中的每个主节点创建一个从节点。")])]),e._v(" "),a("p",[e._v("执行命令后会显示：")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(">>> Creating cluster\n>>> Performing hash slots allocation on 6 nodes...\nUsing 3 masters:\n149.28.37.147:7000\n149.28.37.147:7001\n149.28.37.147:7002\nAdding replica 149.28.37.147:7004 to 149.28.37.147:7000\nAdding replica 149.28.37.147:7005 to 149.28.37.147:7001\nAdding replica 149.28.37.147:7003 to 149.28.37.147:7002\n>>> Trying to optimize slaves allocation for anti-affinity\n[WARNING] Some slaves are in the same host as their master\nM: 65625091304b0fa2dd75a00f62b6aceac1701094 149.28.37.147:7000\n   slots:0-5460 (5461 slots) master\nM: 4da569bf8402e4f75ab6e0fe7076919c22e3f900 149.28.37.147:7001\n   slots:5461-10922 (5462 slots) master\nM: b977680e24f23f8fec96876d9014803ca752e2e2 149.28.37.147:7002\n   slots:10923-16383 (5461 slots) master\nS: 7183e47a64bca23157140229352455d1a1407dc2 149.28.37.147:7003\n   replicates b977680e24f23f8fec96876d9014803ca752e2e2\nS: b2f916a643fefef1d43dbd1ef5d22f72c0ee43d6 149.28.37.147:7004\n   replicates 65625091304b0fa2dd75a00f62b6aceac1701094\nS: e362d9aae5fe3e9c343d266a5ab952272e0e37b0 149.28.37.147:7005\n   replicates 4da569bf8402e4f75ab6e0fe7076919c22e3f900\nCan I set the above configuration? (type 'yes' to accept): \n")])])]),a("p",[e._v("我们输入yes，回车：")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(">>> Nodes configuration updated\n>>> Assign a different config epoch to each node\n>>> Sending CLUSTER MEET messages to join the cluster\nWaiting for the cluster to join...\n>>> Performing Cluster Check (using node 149.28.37.147:7000)\nM: 65625091304b0fa2dd75a00f62b6aceac1701094 149.28.37.147:7000\n   slots:0-5460 (5461 slots) master\n   1 additional replica(s)\nM: b977680e24f23f8fec96876d9014803ca752e2e2 149.28.37.147:7002\n   slots:10923-16383 (5461 slots) master\n   1 additional replica(s)\nS: e362d9aae5fe3e9c343d266a5ab952272e0e37b0 149.28.37.147:7005\n   slots: (0 slots) slave\n   replicates 4da569bf8402e4f75ab6e0fe7076919c22e3f900\nS: b2f916a643fefef1d43dbd1ef5d22f72c0ee43d6 149.28.37.147:7004\n   slots: (0 slots) slave\n   replicates 65625091304b0fa2dd75a00f62b6aceac1701094\nM: 4da569bf8402e4f75ab6e0fe7076919c22e3f900 149.28.37.147:7001\n   slots:5461-10922 (5462 slots) master\n   1 additional replica(s)\nS: 7183e47a64bca23157140229352455d1a1407dc2 149.28.37.147:7003\n   slots: (0 slots) slave\n   replicates b977680e24f23f8fec96876d9014803ca752e2e2\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n")])])]),a("p",[e._v("集群搭建完毕。我们可以使用Spring-Boot非常方便的去访问Redis集群了。")]),e._v(" "),a("h3",{attrs:{id:"三、ruby版本过低问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、ruby版本过低问题"}},[e._v("#")]),e._v(" 三、Ruby版本过低问题")]),e._v(" "),a("p",[e._v("在使用redis-trib.rb时，需要先安装ruby：")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ yum -y install ruby ruby-devel rubygems rpm-build\n$ gem install redis\n")])])]),a("p",[e._v("这是出现redis requires Ruby version >= 2.2.2的报错，我们先安装rvm：")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ curl -L get.rvm.io | bash -s stable\n$ source /usr/local/rvm/scripts/rvm\n")])])]),a("p",[e._v("查看版本")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("rvm list known\n")])])]),a("p",[e._v("安装2.4.1版本")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("rvm install 2.4.1\n")])])]),a("p",[e._v("使用2.4.1版本")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("rvm use 2.4.1\n")])])]),a("p",[e._v("移除2.0.0版本")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("rvm remove 2.0.0\n")])])]),a("p",[e._v("查看当前ruby版本")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ruby --version\n")])])]),a("p",[e._v("再安装redis，就可以了")]),e._v(" "),a("div",{staticClass:"language-jshelllanguage extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("gem install redis\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);