(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{416:function(e,p){e.exports="data:image/png;base64,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"},417:function(e,p,t){e.exports=t.p+"assets/img/oauth-2.6e0fca73.png"},487:function(e,p,t){"use strict";t.r(p);var a=t(42),r=Object(a.a)({},(function(){var e=this,p=e.$createElement,a=e._self._c||p;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[e._v("#")]),e._v(" 背景")]),e._v(" "),a("p",[e._v("上一篇我们介绍了单点登录（SSO），它能够实现多个系统的统一认证。今天我们来谈一谈近几年来非常流行的，大名鼎鼎的OAuth。它也能完成\n统一认证，而且还能做更多的事情。至于OAuth与SSO的区别，将在文章最后总结。")]),e._v(" "),a("p",[a("img",{attrs:{src:t(416),alt:"image1"}})]),e._v(" "),a("p",[e._v("如上图所示，用户通过浏览器（Browser）访问app1，他想用微信的账号直接登录，这样就免去了在app1系统的注册流程。这样的流程完全符合\n单点登录（SSO），但我们今天要看看OAuth是怎么做的。")]),e._v(" "),a("h2",{attrs:{id:"具体流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#具体流程"}},[e._v("#")]),e._v(" 具体流程")]),e._v(" "),a("p",[a("img",{attrs:{src:t(417),alt:"image2"}})]),e._v(" "),a("p",[e._v("流程比单点登录（SSO）复杂了很多，但是它比SSO更强大。接下来我们好好捋一捋这个流程：")]),e._v(" "),a("ol",[a("li",[e._v("用户访问app1系统，app1返回登录页，让用户登录。")]),e._v(" "),a("li",[e._v("用户点击微信登录，这里的微信就是OAuth Server，跳转到微信登录页，带上参数appid和回调地址（backUrl）。关于appid我们要详细\n说一下，我们在与OAuth Server做对接的时候，先要在OAuth Server上注册自己的系统（app1），需要填写应用的名称、回调地址等，\nOAuth Server会生成appid和appSecret，这两个变量是非常关键的。")]),e._v(" "),a("li",[e._v("微信后台（OAuth Server）根据appid查找到app1的注册信息，校验参数backUrl和注册的回调地址是否一致（这里可以只校验域名或者一级域名，\n具体要看OAuth Server怎么设计），如果校验不通过则返回错误，校验成功则返回授权页。")]),e._v(" "),a("li",[e._v("微信弹出授权页，如果微信没有登录则弹出登录并授权页。这个过程是微信询问用户，是否同意app1系统访问微信的资源。用户授权后，\n微信后台（OAuth Server）会生成这个用户对应的code，并通过app1的backUrl返回app1系统。")]),e._v(" "),a("li",[e._v("app1系统拿到code后，再带上appid和appSecret从后台访问微信后台（OAuth Server），换取用户的token。")]),e._v(" "),a("li",[e._v("app1拿到token后，再去微信后台（OAuth Server）获取用户的信息。")]),e._v(" "),a("li",[e._v("app1设置session为登录状态，并将用户信息（昵称、头像等）返回给Browser。")])]),e._v(" "),a("p",[e._v("到这里，OAuth的授权流程就结束了。"),a("strong",[e._v("有的同学可能很快就会问到：用户授权后，为什么不直接返回token，而是要用code换取token？\n这是因为如果直接返回token，token会先到浏览器（Browser），然后再到app1系统，到了浏览器，这个token就是不安全的了，有可能被\n窃取，token被窃取后，微信后台（OAuth Server）中，这个用户的信息就不安全了。然而在用code换取token时，是带上了appid和appSecret\n的，微信后台（OAuth Server）可以判断appid和appSecret的合法性，确认无误后，再将token返回给app1。这里是直接返回app1，没有经过浏览器，\ntoken是安全的。")])]),e._v(" "),a("h3",{attrs:{id:"静默登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静默登录"}},[e._v("#")]),e._v(" 静默登录")]),e._v(" "),a("p",[e._v("上面的流程是用户先访问app1，点击微信登录后，跳到微信。如果我们先打开了微信，在微信里边再打开app1，这个流程就好像我们在\n微信里打开了京东，这里微信就是OAuth Server，京东就是app1。在这个流程中，我们可以省略掉询问用户是否授权的过程，也就是在微信里\n打开京东（app1）的时候，京东（app1）带着appid和backUrl访问微信（OAuth Server），微信（OAuth Server）验证appid和backUrl，\n并且微信（OAuth Server）已经是登录的，这里并没有询问用户是否授权京东访问自己在微信的资源，直接将code返回给了京东。从而使\n京东登录，并且在京东里显示的用户在微信中的昵称和头像等信息。")]),e._v(" "),a("p",[e._v("使用静默登录一般都是你的系统做的比较牛了，被资源方看中了，要把你的系统嵌入到资源方去。比如：微信中嵌入了京东。")]),e._v(" "),a("p",[e._v("上面的例子中，我们只做了获取用户信息，其实还可以开放很多信息，例如：用户的账户余额等。要开放哪些资源就看OAuth Server的了。\n这也就是我们常说的open api。要做open api，上面的OAuth流程是必不可少的。")]),e._v(" "),a("h2",{attrs:{id:"与单点登录-sso-的对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#与单点登录-sso-的对比"}},[e._v("#")]),e._v(" 与单点登录（SSO）的对比")]),e._v(" "),a("p",[e._v("单点登录（SSO）是保障客户端（app1）的用户资源的安全 。")]),e._v(" "),a("h2",{attrs:{id:"oauth则是保障服务端-oauth-的用户资源的安全-。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oauth则是保障服务端-oauth-的用户资源的安全-。"}},[e._v("#")]),e._v(" OAuth则是保障服务端（OAuth）的用户资源的安全 。")]),e._v(" "),a("p",[e._v("单点登录（SSO）的客户端（app1）要获取的最终信息是，这个用户到底有没有权限访问我（app1）的资源。")]),e._v(" "),a("h2",{attrs:{id:"oauth获取的最终信息是-我-oauth-server-的用户的资源到底能不能让你-app1-访问。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oauth获取的最终信息是-我-oauth-server-的用户的资源到底能不能让你-app1-访问。"}},[e._v("#")]),e._v(" OAuth获取的最终信息是，我（OAuth Server）的用户的资源到底能不能让你（app1）访问。")]),e._v(" "),a("p",[e._v("单点登录（SSO），资源都在客户端（app1）这边，不在SSO Server那一方。 用户在给SSO Server提供了用户名密码后，作为客户端app1并不知道这件事。\n随便给客户端（app1）个ST，那么客户端（app1）是不能确定这个ST是否有效，所以要拿着这个ST去SSO Server再问一下，这个ST是否有效，\n是有效的我（app1）才能让这个用户访问。")]),e._v(" "),a("p",[e._v("OAuth认证，资源都在OAuth Server那一方，客户端（app1）想获取OAuth Server的用户资源。 所以在最安全的模式下，用户授权之后，\n服务端（OAuth Server）并不能通过重定向将token发给客户端（app1），因为这个token有可能被黑客截获，如果黑客截获了这个token，\n那么用户的资源（OAuth Server）也就暴露在这个黑客之下了。 于是OAuth Server通过重定向发送了一个认证code给客户端（app1），\n客户端（app1）在后台，通过https的方式，用这个code，以及客户端和服务端预先商量好的密码（appid和appSecret），才能获取到token，\n这个过程是非常安全的。 如果黑客截获了code，他没有那串预先商量好的密码（appid和appSecret），他也是无法获取token的。\n这样OAuth就能保证请求资源这件事，是用户同意的，客户端（app1）也是被认可的，可以放心的把资源发给这个客户端（app1）了。")]),e._v(" "),a("p",[a("strong",[e._v("总结：所以单点登录（SSO）和OAuth在流程上的最大区别就是，通过ST或者code去认证的时候，需不需要预先商量好的密码（appid和appSecret）。")])]),e._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),a("p",[e._v("OAuth和SSO都可以做统一认证登录，但是OAuth的流程比SSO复杂。SSO只能做用户的认证登录，OAuth不仅能做用户的认证登录，开可以做\nopen api开放更多的用户资源。")])])}),[],!1,null,null,null);p.default=r.exports}}]);